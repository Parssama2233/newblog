---
import PostLayout from '@layouts/Post.astro';
import {
  getCategoryPathSegment,
  getPostCategory,
  getPostLanguage,
  getPostSlug,
  getPosts,
} from '@lib/content';
import { listNonDefaultLocales } from '@lib/language';

export async function getStaticPaths() {
  const locales = listNonDefaultLocales();

  const paths = await Promise.all(
    locales.map(async (locale) => {
      const posts = await getPosts({ lang: locale });
      return posts.map((entry) => ({
        params: {
          lang: getPostLanguage(entry),
          category: getCategoryPathSegment(getPostCategory(entry)),
          slug: getPostSlug(entry),
        },
        props: { entry },
      }));
    }),
  );

  return paths.flat();
}

const { entry } = Astro.props;
const { Content, headings } = await entry.render();
---
<PostLayout entry={entry} Content={Content} headings={headings} />
